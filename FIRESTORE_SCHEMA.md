# Firebase Firestore Strategy (NoSQL)

Aura has fully migrated from Supabase (PostgreSQL) to Firebase (Firestore). Consequently, there is no `.sql` schema file to run. 

Instead of tables and rows, Firestore uses Collections and Documents. You do not need to pre-create these; they will be generated automatically when the app writes its first piece of data. 

However, you should understand the schema structure for Security Rules and indexing.

## Collections & Documents Structure

### 1. `users` Collection
Stores references to users who have logged in.
- **Document ID**: Matches the Firebase Authentication UID.
- **Fields:**
  - `email` (string): The user's email address.
  - `full_name` (string): The display name or extracted prefix from their email.
  - `avatar_url` (string, optional): A URL to their profile picture if they signed in with Google.

### 2. `events` Collection
Stores instances of created events.
- **Document ID**: Auto-generated by Firestore (`adminDb.collection('events').doc().id`).
- **Fields:**
  - `code` (string): An 8-character unique alphanumeric code used in the URL (`/events/[code]`).
  - `name` (string): The display name of the event.
  - `description` (string, nullable)
  - `location` (string, nullable)
  - `start_date` (string/ISO 8601, nullable)
  - `end_date` (string/ISO 8601, nullable)
  - `is_public` (boolean): Controls visibility in the master `/events` feed.
  - `created_by` (string): The UID of the user who created it.
  - `created_at` (string/ISO 8601): Timestamp of creation.

### 3. `uploads` Collection
Stores metadata about photos/videos uploaded to an event's gallery. The actual files are in Firebase Cloud Storage.
- **Document ID**: Auto-generated by Firestore.
- **Fields:**
  - `event_id` (string): The ID of the parent event document.
  - `uploaded_by` (string, nullable): The UID of the person who uploaded it (or created the event).
  - `file_type` (string): Either `"photo"` or `"video"`.
  - `file_url` (string): The public HTTP URL pointing to the Firebase Storage bucket.
  - `file_size` (number): Size in bytes.
  - `width` (number)
  - `height` (number)
  - `ai_tags` (array of strings, optional): Array of labels generated by Google Cloud Vision.
  - `created_at` (string/ISO 8601): Timestamp.
  - `metadata` (object): Extra details (like original Google Photos data tracking).

## Storage Buckets
In Firebase Storage, you need to create the default bucket. Files will be stored in:
- `events/{event_id}/{file_id}.jpg` (or `.mp4`)

## Indexes
You will need to create a few Composite Indexes in the Firebase Console if you do complex sorting. Watch the browser console; Firebase will provide direct links to create missing indexes when they are needed (e.g., ordering `uploads` by `created_at` where `event_id == XYZ`).
